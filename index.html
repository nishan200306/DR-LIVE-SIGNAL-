<!DOCTYPE html>
<html lang="si">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Predictor App</title>

  <!-- Parse SDK -->
  <script src="https://npmcdn.com/parse/dist/parse.min.js"></script>
  <!-- Title font for splash -->
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

  <style>
    @property --angle { syntax:'<angle>'; initial-value:0deg; inherits:false; }
    @keyframes rgb-lights { from{--angle:0deg} to{--angle:360deg} }
    @keyframes spin { from{transform:rotate(0)} to{transform:rotate(360deg)} }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    @keyframes floaty { 0%{transform:translateY(0)} 50%{transform:translateY(-6px)} 100%{transform:translateY(0)} }

    :root{
      --gold:#FFD700;
      --blue1:#2aa4ff;
      --blue2:#1e90ff;
      --green:#00ff99;
    }

    /* BACKGROUND CANVAS with red theme */
    #bgCanvas{
      position:fixed; inset:0; z-index:0; pointer-events:none;
      background:
        radial-gradient(1200px 800px at 100% -10%, rgba(255,56,56,.10), transparent 60%),
        radial-gradient(900px 600px at -20% 110%, rgba(255,56,56,.08), transparent 60%),
        #000000;
    }

    body{font-family:'Segoe UI',Arial,sans-serif; background:#000; color:#fff; margin:0; padding:20px; text-align:center; overflow:hidden}
    .page{position:relative; z-index:1; display:none; flex-direction:column; align-items:center; justify-content:center; min-height:calc(100vh - 40px); animation:fadeIn .35s ease}
    .page.active{display:flex}
    h1,h2{color:var(--gold); text-shadow:0 0 10px var(--gold); margin-bottom:36px}
    .button-container{display:flex; flex-direction:column; gap:18px; width:80%; max-width:400px}

    /* Blue animated buttons */
    .nav-button,.back-button{
      position:relative; overflow:hidden;
      padding:18px; font-size:1.05em; font-weight:800; color:#fff; border-radius:12px; cursor:pointer;
      border:1px solid rgba(42,164,255,.45);
      background:linear-gradient(90deg,var(--blue1),var(--blue2),var(--blue1));
      background-size:200% 100%;
      animation:blueSlide 6s linear infinite, blueGlow 2s ease-in-out infinite;
      box-shadow:0 8px 22px rgba(42,164,255,.25), inset 0 1px 0 rgba(255,255,255,.12);
      transition:transform .12s ease;
    }
    .nav-button:active,.back-button:active{ transform:translateY(1px) }
    .nav-button::before,.back-button::before{
      content:""; position:absolute; inset:0; background:
        linear-gradient(120deg, transparent 0%, rgba(255,255,255,.25) 40%, transparent 70%);
      transform:translateX(-120%);
      animation:shineRun 2.8s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes blueSlide{0%{background-position:0 0}100%{background-position:-200% 0}}
    @keyframes blueGlow{
      0%,100%{box-shadow:0 0 0 0 rgba(42,164,255,.22),0 8px 22px rgba(42,164,255,.28)}
      50%{box-shadow:0 0 0 6px rgba(42,164,255,.12),0 10px 26px rgba(42,164,255,.45)}
    }
    @keyframes shineRun{0%{transform:translateX(-120%)}60%{transform:translateX(120%)}100%{transform:translateX(120%)}}

    .back-button{position:absolute; top:20px; left:20px; padding:10px 16px; font-size:.95em}

    .circle-wrapper{position:relative; width:280px; height:280px; display:flex; align-items:center; justify-content:center}
    .circle{
      position:relative; width:100%; height:100%; border-radius:50%; animation:spin 10s linear infinite, rgb-lights 2s linear infinite;
      border:5px solid transparent;
      background-image:linear-gradient(black,black), conic-gradient(from var(--angle), red,yellow,lime,aqua,blue,magenta,red);
      background-origin:border-box; background-clip:content-box, border-box;
      box-shadow:0 0 15px 5px rgba(255,255,255,.1), 0 0 30px 15px rgba(255,0,255,.2), inset 0 0 15px 5px rgba(0,255,255,.2)
    }
    .circle-inner-content{position:absolute; display:flex; flex-direction:column; align-items:center; justify-content:center}
    .prediction-time{font-size:2.4em; color:#FF4136; text-shadow:0 0 8px #FF4136}
    .prediction-odd{font-size:2em; color:#00FF00; text-shadow:0 0 8px #00FF00; margin-top:10px}
    .loader{display:none; margin-top:10px; color:#cbd5e1; font-size:.9em}
    .loader.show{display:block}

    /* PIN modal */
    .modal-overlay{position:fixed; inset:0; background:rgba(0,0,0,.8); display:none; justify-content:center; align-items:center; z-index:1000}
    .modal-content{background:#1a1a1a; padding:24px; border-radius:10px; border:1px solid rgba(255,255,255,.18); width:80%; max-width:320px; text-align:center; box-shadow:0 20px 50px rgba(0,0,0,.55)}
    #pin-input{font-size:24px; text-align:center; padding:10px; width:150px; margin:14px auto; display:block; background:#333; color:#fff; border:1px solid #555; border-radius:6px}
    .modal-buttons{display:flex; gap:10px; justify-content:center}
    #pin-submit,#pin-cancel{padding:10px 18px; font-size:1em; border-radius:6px; border:none; cursor:pointer}
    #pin-submit{background:#28a745; color:#fff}
    #pin-cancel{background:#dc3545; color:#fff}
    #pin-error{color:#ff6b6b; height:1.1em; font-weight:700; margin:2px 0 8px}

    /* SPLASH (DR LIVE SIGNAL) with HORIZONTAL PROGRESS */
    .splash{
      position:fixed; inset:0; z-index:999; display:grid; place-items:center;
      background:
        radial-gradient(1200px 800px at 50% -10%, rgba(0,255,153,.10), transparent 60%),
        linear-gradient(180deg, rgba(0,0,0,.85), rgba(0,0,0,.95));
      transition:opacity .5s ease, visibility .5s ease;
    }
    .splash.hide{opacity:0; visibility:hidden}
    .splash-inner{display:flex; flex-direction:column; align-items:center; gap:14px; text-align:center}
    .splash-title{
      font-family:'Bebas Neue', system-ui, sans-serif; letter-spacing:4px;
      font-size:56px; color:#d7ffe9; text-shadow:0 0 18px rgba(0,255,153,.35);
      animation:floaty 2.4s ease-in-out infinite;
    }
    .progress-wrap{width:min(520px, 86vw); display:flex; flex-direction:column; gap:8px}
    .progress-bar{
      position:relative; height:10px; border-radius:999px; overflow:hidden;
      background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.12);
      box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
    }
    .progress-fill{
      position:absolute; left:0; top:0; height:100%; width:0%;
      background:linear-gradient(90deg, rgba(0,255,153,.8), rgba(0,255,200,.9), rgba(0,255,153,.8));
      box-shadow:0 0 12px rgba(0,255,153,.45);
    }
    .progress-label{font-weight:900; color:#a4d9c9; letter-spacing:.4px}
  </style>
</head>
<body>
  <!-- Animated background -->
  <canvas id="bgCanvas"></canvas>

  <!-- SPLASH: DR LIVE SIGNAL + Horizontal progress -->
  <div id="splash" class="splash" role="dialog" aria-modal="true" aria-label="Loading">
    <div class="splash-inner">
      <div class="splash-title">DR LIVE SIGNAL</div>
      <div class="progress-wrap" aria-live="polite">
        <div class="progress-bar" aria-label="Loading progress">
          <div id="progressFill" class="progress-fill"></div>
        </div>
        <div class="progress-label"><span id="progressNum">1</span>%</div>
      </div>
    </div>
  </div>

  <!-- HOME -->
  <div id="home-page" class="page active">
    <h1>PREDICTOR</h1>
    <div class="button-container">
      <button class="nav-button" data-target="xbet-page" data-service="1XBET">1XBET</button>
      <button class="nav-button" data-target="melbet-page" data-service="MELBET">MELBET</button>
      <button class="nav-button" data-target="strz-page" data-service="888STRZ">888STRZ</button>
    </div>
  </div>

  <!-- PAGES -->
  <div id="xbet-page" class="page">
    <button class="back-button">Back</button>
    <h2>1XBET PREDICTOR</h2>
    <div class="circle-wrapper">
      <div class="circle"></div>
      <div class="circle-inner-content">
        <span class="prediction-time" id="time-xbet-page">--:--:--</span>
        <span class="prediction-odd" id="odd-xbet-page">--.--x</span>
        <div class="loader" id="load-xbet-page">Loading…</div>
      </div>
    </div>
  </div>

  <div id="melbet-page" class="page">
    <button class="back-button">Back</button>
    <h2>MELBET PREDICTOR</h2>
    <div class="circle-wrapper">
      <div class="circle"></div>
      <div class="circle-inner-content">
        <span class="prediction-time" id="time-melbet-page">--:--:--</span>
        <span class="prediction-odd" id="odd-melbet-page">--.--x</span>
        <div class="loader" id="load-melbet-page">Loading…</div>
      </div>
    </div>
  </div>

  <div id="strz-page" class="page">
    <button class="back-button">Back</button>
    <h2>888STRZ PREDICTOR</h2>
    <div class="circle-wrapper">
      <div class="circle"></div>
      <div class="circle-inner-content">
        <span class="prediction-time" id="time-strz-page">--:--:--</span>
        <span class="prediction-odd" id="odd-strz-page">--.--x</span>
        <div class="loader" id="load-strz-page">Loading…</div>
      </div>
    </div>
  </div>

  <!-- PIN MODAL -->
  <div id="pin-modal" class="modal-overlay" role="dialog" aria-modal="true">
    <div class="modal-content">
      <h3 id="pin-title">Enter PIN</h3>
      <input type="password" id="pin-input" maxlength="4" inputmode="numeric" pattern="\d{4}" autocomplete="one-time-code" />
      <p id="pin-error"></p>
      <div class="modal-buttons">
        <button id="pin-cancel">Cancel</button>
        <button id="pin-submit">Enter</button>
      </div>
    </div>
  </div>

  <script>
    /* === Parse init === */
    Parse.initialize("yJIyt85Wo4x3uQpZrGyuSSuw1i2a3DaXAHEre4Hm","HVVxjkWNYnylI7SYmht6DHH2sTrhheJbHs79qEQj");
    Parse.serverURL = "https://parseapi.back4app.com/";

    /* === Red Aviator-style background: moving odds + plane === */
    (function(){
      const c = document.getElementById('bgCanvas');
      const ctx = c.getContext('2d');
      let W=0, H=0, DPR=1;
      const ODD_COUNT = 22;
      let odds = [];
      let plane = null;

      function resize(){
        DPR = Math.min(2, window.devicePixelRatio||1);
        W = Math.floor(window.innerWidth);
        H = Math.floor(window.innerHeight);
        c.width = Math.floor(W*DPR);
        c.height = Math.floor(H*DPR);
        c.style.width = W+'px';
        c.style.height = H+'px';
        ctx.setTransform(DPR,0,0,DPR,0,0);
        spawnAll();
      }

      function randOdd(){
        const v = 1.10 + Math.random()*(6.5-1.1);
        return (Math.round(v*100)/100).toFixed(2)+'x';
      }

      function spawnOdd(fromRight=true){
        const yPad = 40;
        return {
          text: randOdd(),
          x: fromRight ? (W + Math.random()*200) : (-100 - Math.random()*200),
          y: yPad + Math.random()*(H - yPad*2),
          speed: 0.6 + Math.random()*1.4,
          amp: 10 + Math.random()*26,
          phase: Math.random()*Math.PI*2,
          dir: -1,
          size: 14 + Math.random()*6
        };
      }

      function spawnAll(){
        odds = [];
        for(let i=0;i<ODD_COUNT;i++){
          const o = spawnOdd(true);
          o.x = Math.random()*W;
          odds.push(o);
        }
        plane = {
          x: -60, y: H*0.28, baseY: H*0.28,
          speed: 1.2, amp: 36, freq: 0.0025
        };
      }

      function drawChip(o, time){
        const y = o.y + Math.sin((time*0.002 + o.phase))*o.amp;
        o.x += o.dir * o.speed;

        ctx.save();
        ctx.font = `bold ${o.size}px Segoe UI, Arial`;
        ctx.shadowColor = 'rgba(255,80,80,.65)';
        ctx.shadowBlur = 12;
        ctx.fillStyle = 'rgba(255,95,95,.95)';
        ctx.fillText(o.text, o.x, y);
        ctx.restore();

        if(o.x < -120){
          const r = spawnOdd(true);
          o.text=r.text; o.x=r.x; o.y=r.y; o.speed=r.speed; o.amp=r.amp; o.phase=r.phase; o.size=r.size;
        }
      }

      function drawPlane(time){
        if(!plane) return;
        plane.x += plane.speed;
        plane.y = plane.baseY + Math.sin(time*plane.freq)*plane.amp;

        ctx.save();
        const grad = ctx.createLinearGradient(plane.x-140, plane.y, plane.x, plane.y);
        grad.addColorStop(0,'rgba(255,70,70,0)');
        grad.addColorStop(1,'rgba(255,70,70,.65)');
        ctx.strokeStyle = grad;
        ctx.lineWidth = 2;
        ctx.shadowColor = 'rgba(255,70,70,.4)';
        ctx.shadowBlur = 10;
        ctx.beginPath();
        ctx.moveTo(plane.x-140, plane.y);
        ctx.lineTo(plane.x-10, plane.y);
        ctx.stroke();
        ctx.restore();

        ctx.save();
        ctx.font = '20px Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, sans-serif';
        ctx.shadowColor = 'rgba(255,90,90,.6)';
        ctx.shadowBlur = 10;
        ctx.fillStyle = '#ff7777';
        ctx.fillText('✈', plane.x, plane.y+6);
        ctx.restore();

        if(plane.x > W + 60){
          plane.x = -60;
          plane.baseY = 80 + Math.random()*(H-160);
        }

        ctx.save();
        ctx.font = 'bold 16px Segoe UI, Arial';
        ctx.shadowColor = 'rgba(255,100,100,.7)';
        ctx.shadowBlur = 12;
        ctx.fillStyle = '#ff8a8a';
        ctx.fillText(randOdd(), plane.x+24, plane.y-14);
        ctx.restore();
      }

      function step(now){
        ctx.clearRect(0,0,W,H);

        ctx.save();
        ctx.strokeStyle = 'rgba(255,60,60,.06)';
        ctx.lineWidth = 1;
        for(let x=0; x<W; x+=40){ ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,H); ctx.stroke(); }
        for(let y=0; y<H; y+=40){ ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(W,y); ctx.stroke(); }
        ctx.restore();

        const time = now;
        for(const o of odds){ drawChip(o, time); }
        drawPlane(now);

        requestAnimationFrame(step);
      }

      window.addEventListener('resize', resize);
      resize();
      requestAnimationFrame(step);
    })();

    /* === App logic + Splash progress === */
    document.addEventListener('DOMContentLoaded', () => {
      const pages = document.querySelectorAll('.page');
      const navButtons = document.querySelectorAll('.nav-button');
      const backButtons = document.querySelectorAll('.back-button');

      const pinModal = document.getElementById('pin-modal');
      const pinTitle = document.getElementById('pin-title');
      const pinInput = document.getElementById('pin-input');
      const pinSubmit = document.getElementById('pin-submit');
      const pinCancel = document.getElementById('pin-cancel');
      const pinError = document.getElementById('pin-error');

      const splash = document.getElementById('splash');
      const progressFill = document.getElementById('progressFill');
      const progressNum  = document.getElementById('progressNum');

      let currentTargetPage = null;
      let currentService = null;
      const unlockedKey = 'pred.unlocked';
      let refreshTimers = {};

      // Splash progress from 1 -> 100
      function runSplashProgress(){
        let p = 1;
        progressFill.style.width = p+'%';
        progressNum.textContent = p;
        const iv = setInterval(()=>{
          p++;
          progressFill.style.width = p+'%';
          progressNum.textContent = p;
          if(p >= 100){
            clearInterval(iv);
            splash.classList.add('hide');
            setTimeout(()=>{ splash.style.display='none'; }, 500);
          }
        }, 20); // ~2 seconds total
      }
      window.addEventListener('load', runSplashProgress);

      function showPage(id){
        pages.forEach(p=>p.classList.remove('active'));
        const el=document.getElementById(id);
        if(el) el.classList.add('active');
      }
      function getUnlocked(){
        try{ return JSON.parse(localStorage.getItem(unlockedKey)||'{}'); }catch(_){ return {}; }
      }
      function setUnlocked(service){
        const st=getUnlocked(); st[service]=true; localStorage.setItem(unlockedKey, JSON.stringify(st));
      }
      function digitsOnly(e){ e.target.value = e.target.value.replace(/\D/g,'').slice(0,4); }

      async function fetchPrediction(service){
        const PredictionData = Parse.Object.extend("PredictionData");
        const q = new Parse.Query(PredictionData).equalTo("serviceName", service);
        const r = await q.first({ useMasterKey: false });
        return r ? {
          time: r.get('predictionTime') || '--:--:--',
          odd: r.get('predictionOdd') || '--.--x',
          pin: r.get('accessPIN') || ''
        } : null;
      }
      function setLoading(pageId, on){
        const loader = document.getElementById('load-' + pageId);
        if(loader) loader.classList.toggle('show', !!on);
      }
      async function showServicePage(service, pageId){
        if(refreshTimers[service]){ clearInterval(refreshTimers[service]); delete refreshTimers[service]; }
        showPage(pageId);
        setLoading(pageId, true);
        try{
          const data = await fetchPrediction(service);
          applyPredictionToPage(pageId, data);
        }catch(e){
          applyPredictionToPage(pageId, null, 'Error loading');
        }finally{
          setLoading(pageId, false);
        }
        refreshTimers[service] = setInterval(async ()=>{
          try{
            const data = await fetchPrediction(service);
            applyPredictionToPage(pageId, data);
          }catch(_){}
        }, 20000);
      }
      function applyPredictionToPage(pageId, data, fallbackMsg){
        const timeEl = document.getElementById(`time-${pageId}`);
        const oddEl  = document.getElementById(`odd-${pageId}`);
        if(!timeEl || !oddEl) return;
        if(!data){
          timeEl.textContent = '--:--:--';
          oddEl.textContent  = fallbackMsg ? fallbackMsg : '--.--x';
        }else{
          timeEl.textContent = String(data.time || '--:--:--');
          const oddTxt = String(data.odd || '--.--x');
          oddEl.textContent = /x$/i.test(oddTxt) ? oddTxt : (oddTxt + 'x');
        }
      }

      // Nav open
      navButtons.forEach(btn=>{
        btn.addEventListener('click', async ()=>{
          currentTargetPage = btn.getAttribute('data-target'); // e.g. 'xbet-page'
          currentService    = btn.getAttribute('data-service'); // e.g. '1XBET'
          const unlocked = getUnlocked();
          if(unlocked[currentService]){
            showServicePage(currentService, currentTargetPage);
          }else{
            pinTitle.textContent = `Enter PIN for ${currentService}`;
            pinInput.value = ''; pinError.textContent = '';
            pinModal.style.display = 'flex';
            pinInput.focus();
          }
        });
      });
      // Back
      backButtons.forEach(b=>{
        b.addEventListener('click', ()=>{
          if(currentService && refreshTimers[currentService]){
            clearInterval(refreshTimers[currentService]); delete refreshTimers[currentService];
          }
          showPage('home-page');
        });
      });

      // PIN modal controls
      pinInput.addEventListener('input', digitsOnly);
      pinInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') pinSubmit.click(); });
      pinCancel.addEventListener('click', ()=>{ pinModal.style.display='none'; });

      pinSubmit.addEventListener('click', async ()=>{
        const enteredPin = (pinInput.value||'').trim();
        if(enteredPin.length !== 4){
          pinError.textContent = 'Please enter a 4-digit PIN.'; return;
        }
        pinSubmit.disabled = true; pinSubmit.textContent = 'Checking…'; pinError.textContent = '';
        try{
          const data = await fetchPrediction(currentService);
          if(data && String(data.pin) === enteredPin){
            setUnlocked(currentService);
            pinModal.style.display='none';
            await showServicePage(currentService, currentTargetPage);
          }else{
            pinError.textContent = 'Incorrect PIN. Try again.';
          }
        }catch(e){
          console.error('PIN check error', e);
          pinError.textContent = 'Error connecting to server.';
        }finally{
          pinSubmit.disabled = false; pinSubmit.textContent = 'Enter'; pinInput.value = '';
        }
      });
    });
  </script>
</body>
</html>
